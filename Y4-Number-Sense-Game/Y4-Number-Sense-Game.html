<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Y4 Interactive Number Sense Game</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#a1a1aa;--accent:#22c55e;--amber:#f59e0b;--err:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;background:var(--bg);color:#e5e7eb}
    header{position:sticky;top:0;z-index:10;background:#0b1220;border-bottom:1px solid #1f2937;padding:16px}
    h1{margin:0;font-size:20px}
    .sub{color:var(--muted);font-size:13px}
    .wrap{max-width:1100px;margin:16px auto;padding:0 16px;display:grid;gap:16px}
    @media(min-width:980px){.wrap{grid-template-columns:1.2fr .8fr}}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:16px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .tab{background:#0b1220;border:1px solid #253042;color:#e5e7eb;border-radius:10px;padding:10px 12px;cursor:pointer}
    .tab.active{border-color:var(--accent);box-shadow:0 0 0 2px #14532d inset}
    .title{font-weight:700;margin:0 0 8px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    button{background:#0b1220;border:1px solid #253042;border-radius:10px;color:#e5e7eb;padding:10px 12px;cursor:pointer}
    button.primary{background:linear-gradient(135deg,#16a34a,#22c55e);border:none;color:#06210d}
    button.warn{background:#1f1300;border:1px solid #6b4e00;color:#ffd166}
    input,select,textarea{background:#0b1220;border:1px solid #253042;border-radius:10px;color:#e5e7eb;padding:10px}
    .result{margin-top:10px;padding:10px;border-radius:10px;background:#0b1220;border:1px solid #1f2937}
    .ok{color:var(--accent)}
    .err{color:var(--err)}
    .pill{padding:6px 10px;border:1px solid #253042;border-radius:999px;background:#0b1220}
    .pv-board{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-top:10px}
    .pv-cell{border:1px dashed #374151;border-radius:12px;min-height:68px;display:flex;align-items:center;justify-content:center;position:relative}
    .pv-cell .lbl{position:absolute;top:6px;left:8px;font-size:11px;color:#9ca3af}
    .drag{background:#0b1220;border:1px solid #374151;border-radius:10px;padding:10px 14px;font-size:18px;cursor:grab}
    .drags{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .drop-ok{outline:2px solid var(--accent)}
    .wrong{outline:2px solid var(--err)}
    .big{font-size:26px;letter-spacing:.3px}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .list{margin:6px 0 0 18px}
    .board{display:grid;grid-template-columns:repeat(8,1fr);gap:8px;margin-top:10px}
    .tile{border:1px solid #253042;background:#0b1220;border-radius:10px;padding:10px;text-align:center}
    .tile.goal{border-color:var(--amber)}
    .badge{border:1px solid #253042;border-radius:999px;padding:6px 10px;background:#0b1220;color:#cbd5e1}
  </style>
</head>
<body>
  <header>
    <h1>Y4 Interactive Number Sense Game</h1>
    <div class="sub">Reading/Writing Numbers • Place Value • Counting • Race to Jannah (Values: ISSM‑3 Ikhlas)</div>
    <div class="tabs">
      <button class="tab active" data-tab="read">1) Read & Write 1000–9999</button>
      <button class="tab" data-tab="place">2) Place Value & Expanded Form</button>
      <button class="tab" data-tab="count">3) Counting ± steps</button>
      <button class="tab" data-tab="race">4) Race to Jannah</button>
      <button class="tab" data-tab="quiz">5) Quick Quiz</button>
    </div>
  </header>

  <div class="wrap">
    <section class="card" id="main">
      <h2 class="title">Activity Panel</h2>
      <div id="view"></div>
    </section>

    <aside class="card">
      <h3 class="title">Teacher Prompts & Value Links</h3>
      <ul class="list">
        <li>Start with a short dua for beneficial knowledge.</li>
        <li><b>Ikhlas (ISSM‑3):</b> Just as each digit has value in its place, every sincere deed has value with Allah.</li>
        <li>Arabic connection: number names & dhikr (e.g., Subhanallah 33×).</li>
        <li>Place value ➜ niyyah: intention gives value to actions like place gives value to digits.</li>
        <li>Tasbih beads hook: counting forwards & backwards with steps of 1/10/100/1000.</li>
        <li>Reflection prompts are built into each activity.</li>
      </ul>
      <div class="result" id="scorebox">Score: <b id="score">0</b> · Attempts: <b id="tries">0</b></div>
    </aside>
  </div>

  <script>
    const $ = (s,el=document)=>el.querySelector(s); const $$=(s,el=document)=>[...el.querySelectorAll(s)];
    let SCORE=0, TRIES=0; const add=(n)=>{SCORE+=n; TRIES++; $('#score').textContent=SCORE; $('#tries').textContent=TRIES};

    $$('.tab').forEach(t=>t.addEventListener('click',()=>{ $$('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active');
      const id=t.dataset.tab; if(id==='read') renderRead(); if(id==='place') renderPlace(); if(id==='count') renderCount(); if(id==='race') renderRace(); if(id==='quiz') renderQuiz(); }));

    // 1) Reading & Writing 1000–9999
    function numToWords(n){
      const ones=['','one','two','three','four','five','six','seven','eight','nine'];
      const tens=['','','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'];
      const teens=['ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'];
      let w=''; const th=Math.floor(n/1000); const h=Math.floor((n%1000)/100); const t=Math.floor((n%100)/10); const o=n%10;
      if(th) w+=ones[th]+" thousand";
      if(h) w+=(w?' ':'')+ones[h]+" hundred";
      if(t||o){
        w+=(w?' and ':' ');
        if(t===1) return w+teens[o];
        if(t>1) w+=tens[t]+(o?('-'+ones[o]):'');
        else w+=ones[o];
      }
      return w.trim();
    }

    function renderRead(){
      const v=$('#view'); v.innerHTML='';
      const makeRand=()=>Math.floor(Math.random()*9000)+1000; let cur=makeRand();
      const ui=document.createElement('div');
      ui.innerHTML=`
        <div class="row"><div class="big">Number: <b id="rnum">${cur}</b></div>
          <button id="new">New</button></div>
        <div class="row">
          <input id="winput" placeholder="Write its name (e.g., two thousand and forty-five)" style="min-width:360px"/>
          <button id="check" class="primary">Check</button>
        </div>
        <div class="row">
          <input id="dinput" placeholder="Type digits for a name you invent" style="min-width:360px"/>
          <button id="gen" title="Check digits ↔ words">Generate name</button>
        </div>
        <div class="result" id="out"></div>
        <div class="result muted">Reflection: "Today we learned that math is part of our lives, especially in counting our deeds (ikhlas)."</div>
      `;
      v.appendChild(ui);
      const norm=s=>s.toLowerCase().replace(/\s+/g,' ').trim();
      $('#new').onclick=()=>{cur=makeRand(); $('#rnum').textContent=cur; $('#out').textContent=''; $('#winput').value=''};
      $('#check').onclick=()=>{
        const want=numToWords(cur); const got=norm($('#winput').value);
        if(got && got===norm(want)){ $('#out').innerHTML='<span class="ok">Correct!</span>'; add(3);} else { $('#out').innerHTML=`<span class="err">Not quite.</span> Correct: <b>${want}</b>`; add(0);} }
      $('#gen').onclick=()=>{
        const d=parseInt($('#dinput').value,10); if(!Number.isInteger(d) || d<1000 || d>9999){ $('#out').innerHTML='<span class="err">Enter a 4‑digit number (1000–9999).</span>'; return; }
        $('#out').innerHTML='In words: <b>'+numToWords(d)+'</b>';
      }
    }

    // 2) Place Value & Expanded Form (drag drop + expanded)
    function renderPlace(){
      const v=$('#view'); v.innerHTML='';
      const rand=()=>Math.floor(Math.random()*9000)+1000; const n=rand();
      const d=String(n).split(''); const th=d[0], h=d[1], t=d[2], o=d[3];
      const ui=document.createElement('div');
      ui.innerHTML=`
        <div class="row"><div class="big">Number: <b>${n}</b></div> <button id="newp">New</button> <button id="hintp" class="warn">Hint</button> <button id="checkp" class="primary">Check</button></div>
        <div class="pv-board" id="board"></div>
        <div class="drags" id="dr"></div>
        <div class="row cols">
          <div class="card" style="background:#0b1220">
            <div class="title">Expanded Form</div>
            <div class="row"><input id="exp" placeholder="e.g., 3000 + 500 + 20 + 1" style="min-width:320px"/> <button id="expchk" class="primary">Check</button></div>
            <div id="expout" class="result"></div>
          </div>
          <div class="card" style="background:#0b1220">
            <div class="title">Reflection</div>
            <div class="muted">Niyyah gives value to actions like place gives value to digits. One word for today?</div>
            <input id="oneword" placeholder="e.g., sincerity"/>
          </div>
        </div>
      `; v.appendChild(ui);
      const cols=[['thousands','Thousands'],['hundreds','Hundreds'],['tens','Tens'],['ones','Ones'],['arabic','Arabic Name (bonus)'],['ikhlas','Ikhlas Link (bonus)']];
      const board=$('#board'); cols.forEach(([k,l])=>{ const c=document.createElement('div'); c.className='pv-cell'; c.dataset.accept=k; c.innerHTML=`<div class="lbl">${l}</div><div class="slot" style="font-size:22px"></div>`;
        c.addEventListener('dragover',e=>{e.preventDefault(); c.classList.add('drop-ok')}); c.addEventListener('dragleave',()=>c.classList.remove('drop-ok'));
        c.addEventListener('drop',e=>{e.preventDefault(); c.classList.remove('drop-ok'); const id=e.dataTransfer.getData('text/plain'); const el=document.getElementById(id); const ok=el && el.dataset.role===c.dataset.accept; if(ok){ c.querySelector('.slot').innerHTML=''; c.querySelector('.slot').appendChild(el);} else { c.classList.add('wrong'); setTimeout(()=>c.classList.remove('wrong'),500);} }); board.appendChild(c); });
      const dr=$('#dr'); const make=(txt,role,id)=>{ const d=document.createElement('div'); d.className='drag'; d.textContent=txt; d.id=id; d.draggable=true; d.dataset.role=role; d.addEventListener('dragstart',e=>e.dataTransfer.setData('text/plain',id)); dr.appendChild(d)}
      make(th,'thousands','d_th'); make(h,'hundreds','d_h'); make(t,'tens','d_t'); make(o,'ones','d_o'); make('alf','arabic','d_ar'); make('sincere','ikhlas','d_i');
      $('#checkp').onclick=()=>{
        const ok=['d_th','d_h','d_t','d_o'].every(id=>{ const el=document.getElementById(id); return el && el.closest('.pv-cell') && el.closest('.pv-cell').dataset.accept===el.dataset.role; });
        if(ok){ add(3); alert('Great! Correct place value sorting.'); } else { add(0); alert('Not yet. Ensure each digit sits in the right place.'); }
      }
      $('#hintp').onclick=()=>{ alert('Thousands → first digit, Hundreds → second digit, Tens → third, Ones → last. Example: 3521 = 3000 + 500 + 20 + 1'); }
      $('#newp').onclick=renderPlace;
      // Expanded form check
      $('#expchk').onclick=()=>{
        const want=[th+'000', h+'00', t+'0', o].map(x=>String(Number(x))).join(' + ');
        const got=$('#exp').value.replace(/\s+/g,'').replace(/\+\+/g,'+');
        const wantCmp=want.replace(/\s+/g,'');
        if(got && (got===wantCmp || got===wantCmp.replace(/\+/g,' + '))){ $('#expout').innerHTML='<span class="ok">Correct expanded form!</span>'; add(3);} else { $('#expout').innerHTML=`<span class="err">Try again.</span> Hint: ${want}`; add(0);} }
    }

    // 3) Counting ± steps
    function renderCount(){
      const v=$('#view'); v.innerHTML='';
      let start=Math.floor(Math.random()*6000)+1000; const steps=[1,10,100,1000,250]; let step=10; let dir=1; let seq=[];
      const ui=document.createElement('div');
      ui.innerHTML=`
        <div class="row"><div class="big">Start: <b id="cstart">${start}</b></div>
          <label>Step</label><select id="cstep">${steps.map(s=>`<option value="${s}">${s}</option>`).join('')}</select>
          <label>Direction</label><select id="cdir"><option value="1">Forward</option><option value="-1">Backward</option></select>
          <button id="cgen">Generate</button>
        </div>
        <div class="row"><input id="cans" placeholder="Enter next 4 numbers" style="min-width:360px"/> <button id="ccheck" class="primary">Check</button> <button id="cnew">New</button></div>
        <div class="result" id="cout"></div>
        <div class="result muted">Reflection: Counting sincerely (like dhikr) builds mastery and patience.</div>
      `; v.appendChild(ui);
      const makeSeq=()=>{ const s=Number($('#cstep').value||step); const d=Number($('#cdir').value||dir); seq=[start + d*s, start + d*2*s, start + d*3*s, start + d*4*s]; }
      $('#cgen').onclick=()=>{ start=Math.floor(Math.random()*6000)+1000; $('#cstart').textContent=start; makeSeq(); $('#cout').textContent=''; $('#cans').value=''};
      $('#ccheck').onclick=()=>{ const got=($('#cans').value||'').split(/[,\s]+/).filter(Boolean).map(x=>Number(x)); if(got.length!==4 || got.some(x=>!Number.isFinite(x))){ $('#cout').innerHTML='<span class="err">Enter 4 numbers separated by spaces or commas.</span>'; return; }
        makeSeq(); const ok=got.every((g,i)=>g===seq[i]); if(ok){ $('#cout').innerHTML='<span class="ok">Nice counting!</span>'; add(3);} else { $('#cout').innerHTML=`<span class="err">Check again.</span> Correct: <b>${seq.join(', ')}</b>`; add(0);} }
      $('#cnew').onclick=renderCount; makeSeq();
    }

    // 4) Race to Jannah (board progression with mixed tasks)
    function renderRace(){
      const v=$('#view'); v.innerHTML='';
      let pos=0; const tiles=16; const ui=document.createElement('div');
      ui.innerHTML=`
        <div class="row"><div class="big">Race to Jannah</div><span class="badge">Answer correctly to move 1–3 steps</span> <button id="rnew">Reset</button></div>
        <div class="board" id="board"></div>
        <div class="row"><input id="rinput" placeholder="Type your answer"/> <button id="rgo" class="primary">Submit</button></div>
        <div class="result" id="rout"></div>
        <div class="muted">"How is doing math like doing good deeds? Even small steps count when done sincerely."</div>
      `; v.appendChild(ui);
      const board=$('#board'); for(let i=0;i<tiles;i++){ const t=document.createElement('div'); t.className='tile'+(i===tiles-1?' goal':''); t.textContent=i===tiles-1?'Jannah ⭐':'Step '+(i+1); board.appendChild(t);} 
      const tasks=[
        {q:'Read in words: 2045', a:'two thousand and forty-five'},
        {q:'Digits for "three thousand and six"', a:'3006'},
        {q:'Expanded form of 3521', a:'3000+500+20+1'},
        {q:'Next 2 in 3200, 3300, __, __', a:'3400 3500'},
        {q:'Count back by 100: start 4500 → next', a:'4400'},
        {q:'Place value of 4 in 1432', a:'hundreds'},
        {q:'Complete: 7000 + 80 + 9 =', a:'7089'},
        {q:'Write in words: 5000', a:'five thousand'},
        {q:'Count forward by 1000 from 2450 → next', a:'3450'},
        {q:'Tens digit of 9786', a:'8'},
      ]; let idx=0;
      const norm=s=>String(s).toLowerCase().replace(/\s+/g,' ').replace(/\band\b/g,'').replace(/\s|-/g,'').trim();
      const show=()=>{ $('#rout').innerHTML='Task: <b>'+tasks[idx].q+'</b>'; $('#rinput').value=''; $('#rinput').focus(); }
      const move=(n)=>{ pos=Math.min(tiles-1,pos+n); $$('#board .tile').forEach((t,i)=>{ t.style.outline=i===pos?'2px solid #22c55e':'none'; }); if(pos===tiles-1){ $('#rout').innerHTML+='<div class="ok">MashaAllah! You reached the goal.</div>'; }
      }
      $('#rgo').onclick=()=>{ const want=tasks[idx].a; const got=$('#rinput').value; const ok=norm(got)===norm(want);
        if(ok){ add(3); $('#rout').innerHTML='<span class="ok">Correct! Move 2 steps.</span>'; move(2);} else { add(0); $('#rout').innerHTML='<span class="err">Not quite.</span> Correct: <b>'+want+'</b>. Move 1 step.'; move(1);} idx=(idx+1)%tasks.length; setTimeout(show,600); }
      $('#rnew').onclick=renderRace; show(); move(0);
    }

    // 5) Quick Quiz
    function renderQuiz(){
      const v=$('#view'); v.innerHTML=''; const qs=[
        {q:'Write in digits: four thousand and nineteen', a:'4019'},
        {q:'Value of 7 in 7,654', a:'7000'},
        {q:'Expanded: 4085 = 4000 + __ + 80 + 5', a:'0'},
        {q:'Next numbers by 250s from 3000 (2 answers)', a:'3250 3500'},
      ]; let i=0, ok=0; const ui=document.createElement('div');
      ui.innerHTML=`<div class="big" id="qq"></div>
        <div class="row"><input id="qa" placeholder="Answer"/> <button id="qnext" class="primary">Submit</button></div>
        <div class="result" id="qo"></div>
        <div class="muted">Close with dua for guidance & gratitude.</div>`; v.appendChild(ui);
      const norm=s=>String(s).toLowerCase().replace(/\s+/g,' ').replace(/\s|-/g,'').trim();
      const show=()=>{$('#qq').innerHTML='Q'+(i+1)+'. '+qs[i].q; $('#qa').value=''; $('#qo').textContent=''; $('#qa').focus();}
      $('#qnext').onclick=()=>{ const want=qs[i].a; const got=$('#qa').value; if(norm(got)===norm(want)){ ok++; add(2); $('#qo').innerHTML='<span class="ok">Correct.</span>';} else { add(0); $('#qo').innerHTML='<span class="err">Answer:</span> <b>'+want+'</b>'; } i++; if(i<qs.length){ setTimeout(show,600)} else { $('#qq').innerHTML='Finished. Score: <b>'+ok+'/'+qs.length+'</b>'; $('#qa').disabled=true; $('#qnext').disabled=true; }}
      show();
    }

    // boot
    renderRead();
  </script>
</body>
</html>
